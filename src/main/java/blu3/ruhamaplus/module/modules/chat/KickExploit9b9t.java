package blu3.ruhamaplus.module.modules.chat;

import blu3.ruhamaplus.module.Category;
import blu3.ruhamaplus.module.Module;
import blu3.ruhamaplus.module.ModuleManager;
import blu3.ruhamaplus.settings.SettingBase;
import blu3.ruhamaplus.settings.SettingMode;
import blu3.ruhamaplus.utils.ClientChat;
import blu3.ruhamaplus.utils.Timer;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.SPacketChat;

import java.util.Collections;
import java.util.List;

public class KickExploit9b9t extends Module {
    public KickExploit9b9t() {
        super("KickExploit9b9t", 0, Category.CHAT, "another fag left the chat", settings);
        this.delay = new Timer();
    }

    private static final List<SettingBase> settings = Collections.singletonList(new SettingMode("Mode: ","NextMessage", "Keyword"));

    private final Timer delay;

    public String targetKeyword = null;



    public boolean onPacketRead(Packet<?> packet)
    {
        switch (this.getSetting(0).asMode().mode) {
            case 0: {
                if (this.delay.passedMs(5000)){
                    ModuleManager.getModuleByName("ChatSuffix").setToggled(false);
                    if (!(this.mc.player == null) && !(this.mc.world == null)) {
                        if (packet instanceof SPacketChat) {
                            SPacketChat sPacketChat = (SPacketChat) packet;
                            String message = sPacketChat.getChatComponent().getUnformattedText();

                            if (!(message.contains(this.mc.player.getName())) && message.startsWith("<")){

                                String[] arr = message.split(" ", 2); // splits the message at " " into 2 parts

                                mc.player.sendChatMessage(arr[1]); // sends the second part, without the username

                                this.delay.reset();
                                ModuleManager.getModuleByName("ChatSuffix").setToggled(true);
                                ClientChat.log("Tried kicking " + arr[0] + ". Disabling.");
                                this.setToggled(false);
                            }
                        }
                    }
                }
            }
            case 1: {
                if (this.delay.passedMs(5000)){
                    ModuleManager.getModuleByName("ChatSuffix").setToggled(false);
                    if (!(this.mc.player == null) && !(this.mc.world == null)) {
                        if (packet instanceof SPacketChat) {
                            SPacketChat sPacketChat = (SPacketChat) packet;
                            String message = sPacketChat.getChatComponent().getUnformattedText();

                            if (message.contains(targetKeyword)){

                                String[] arr = message.split(" ", 2); // splits the message at " " into 2 parts

                                mc.player.sendChatMessage(arr[1]); // sends the second part, without the username

                                this.delay.reset();
                                ModuleManager.getModuleByName("ChatSuffix").setToggled(true);
                            }
                        }
                    }
                }
            }
        }



        return false;
    }
}